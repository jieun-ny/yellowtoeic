;(function(f){var g={};g.init=function(a){var b=true;g._permissions=a||[];g._installListener();window.parent.postMessage('cross-storage:ready','*')};g._installListener=function(){var a=g._listener;if(window.addEventListener){window.addEventListener('message',a,false)}else{window.attachEvent('onmessage',a)}};g._listener=function(a){var b,targetOrigin,request,method,error,result,response;b=(a.origin==='null')?'file://':a.origin;if(a.data==='cross-storage:poll'){return window.parent.postMessage('cross-storage:ready',a.origin)}if(a.data==='cross-storage:ready')return;try{request=JSON.parse(a.data)}catch(err){return}if(!request||typeof request.method!=='string'){return}method=request.method.split('cross-storage:')[1];if(!method){return}else if(!g._permitted(b,method)){error='Invalid permissions for '+method}else{try{result=g['_'+method](request.params)}catch(err){error=err.message}}response=JSON.stringify({id:request.id,error:error,result:result});targetOrigin=(b==='file://')?'*':b;window.parent.postMessage(response,targetOrigin)};g._permitted=function(a,b){var c,i,entry,match;c=['get','set','del','clear','getKeys'];if(!g._inArray(b,c)){return false}for(i=0;i<g._permissions.length;i++){entry=g._permissions[i];if(!(entry.origin instanceof RegExp)||!(entry.allow instanceof Array)){continue}match=entry.origin.test(a);if(match&&g._inArray(b,entry.allow)){return true}}return false};g._set=function(a){this.setCookie(a.key,a.value,a.expires)};g._get=function(a){var c;var b=[];for(c=0;c<a.keys.length;c++){try{var d=this.getCookie(a.keys[c])}catch(e){d=null}b.push(d)}return 1<b.length?b:b[0]};g.getCookie=function(a){var c,b=window.document.cookie.split(";");for(c=0;c<b.length;c++){var d=b[c].substr(0,b[c].indexOf("="));var e=b[c].substr(b[c].indexOf("=")+1);d=d.replace(/^\s+|\s+$/g,"");if(d==a)return unescape(e)}};g.setCookie=function(a,b,c){var d=new Date();d.setTime(d.getTime()+(1000*c));var e=escape(b)+((c==null)?"":"; expires="+d.toUTCString())+"; path=/";window.document.cookie=a+"="+e;window.localStorage.setItem(a,b)};g._del=function(a){for(var i=0;i<a.keys.length;i++){window.localStorage.removeItem(a.keys[i])}};g._clear=function(){window.localStorage.clear()};g._getKeys=function(a){var i,length,keys;keys=[];length=window.localStorage.length;for(i=0;i<length;i++){keys.push(window.localStorage.key(i))}return keys};g._inArray=function(a,b){for(var i=0;i<b.length;i++){if(a===b[i])return true}return false};g._now=function(){if(typeof Date.now==='function'){return Date.now()}return new Date().getTime()};if(typeof module!=='undefined'&&module.exports){module.exports=g}else if(typeof exports!=='undefined'){exports.CrossStorageHub=g}else if(typeof define==='function'&&define.amd){define([],function(){return g})}else{f.CrossStorageHub=g}}(this));