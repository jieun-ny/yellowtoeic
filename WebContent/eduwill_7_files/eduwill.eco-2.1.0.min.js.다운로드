"use strict";var eduwill,ecoContentHandler;function stageModeInit(){stageModeInitStep1(),setTimeout("stageModeInitStep2()",0),setTimeout("stageModeInitStep2()",100),setTimeout("stageModeInitStep2()",500),setTimeout("stageModeInitStep2()",1e3),setTimeout("stageModeInitStep2()",3e3)}function stageModeInitStep1(){$("["+eduwill.eco.EcoContentHandler.ECO_INDENTITY_ATTR+"]").append('<div class="dim"><span></span><div style="position:absolute; top:10px; right:10px;"><a href="#" onclick="$(this).parent().parent().remove(); return false;" style="font-size:12px; color:#fff; font-weight:bold;">닫기</a></div></div>'),$("["+eduwill.eco.EcoContentHandler.ECO_INDENTITY_ATTR+"]").wrapInner('<div class="innerWrap"></div>'),$("div[class=innerWrap]").on("mouseover",function(){$(this).addClass("hover").siblings("div[class=innerWrap]").removeClass("hover"),$(this).find(".dim").show()}).mouseout(function(){$(this).find(".dim").hide()})}function stageModeInitStep2(){$("["+eduwill.eco.EcoContentHandler.ECO_INDENTITY_ATTR+"]").each(function(e){$(this).find(" .innerWrap").height(),$(this).find(".dim").find("span").text($(this).attr(eduwill.eco.EcoContentHandler.ECO_INDENTITY_ATTR))})}function getEcoDynamicContent(e,o,t){"undefined"!=typeof $&&(new eduwill.eco.EcoContentHandler).get(e,o,t)}!function(e){!function(o){var t=function(){function o(e){this.className=""}return o.prototype.getFunctionName=function(e){var o=/function (.{1,})\(/.exec(e.constructor.toString());return o&&o.length>1?o[1]:""},o.prototype.setLoggerLevel=function(t){if(this.debug("set log level : "+debug),t==e.eco.Logger.LOGGER_LEVEL_ERROR||t==e.eco.Logger.LOGGER_LEVEL_WARNING||t==e.eco.Logger.LOGGER_LEVEL_INFO||t==e.eco.Logger.LOGGER_LEVEL_DEBUG)o.loggerLevel=t;else{var n="설정하려는 log level 값이 유효하지 않습니다.";n+=" [Level : "+e.eco.Logger.LOGGER_LEVEL_ERROR+"-"+e.eco.Logger.LOGGER_LEVEL_ERROR_TITLE+", "+e.eco.Logger.LOGGER_LEVEL_WARNING+"-"+e.eco.Logger.LOGGER_LEVEL_WARNING_TITLE+", "+e.eco.Logger.LOGGER_LEVEL_INFO+"-"+e.eco.Logger.LOGGER_LEVEL_INFO_TITLE+", "+e.eco.Logger.LOGGER_LEVEL_DEBUG+"-"+e.eco.Logger.LOGGER_LEVEL_DEBUG_TITLE+"]",this.print(o.LOGGER_LEVEL_ERROR,o.LOGGER_LEVEL_ERROR_TITLE,n)}},o.prototype.getLoggerLevel=function(){var o="현재 로그레벨 : "+e.eco.Logger.loggerLevel;return o+=" [Level : "+e.eco.Logger.LOGGER_LEVEL_ERROR+"-"+e.eco.Logger.LOGGER_LEVEL_ERROR_TITLE+", "+e.eco.Logger.LOGGER_LEVEL_WARNING+"-"+e.eco.Logger.LOGGER_LEVEL_WARNING_TITLE+", "+e.eco.Logger.LOGGER_LEVEL_INFO+"-"+e.eco.Logger.LOGGER_LEVEL_INFO_TITLE+", "+e.eco.Logger.LOGGER_LEVEL_DEBUG+"-"+e.eco.Logger.LOGGER_LEVEL_DEBUG_TITLE+"]"},o.prototype.debug=function(e){this.print(o.LOGGER_LEVEL_DEBUG,o.LOGGER_LEVEL_DEBUG_TITLE,e)},o.prototype.info=function(e){this.print(o.LOGGER_LEVEL_INFO,o.LOGGER_LEVEL_INFO_TITLE,e)},o.prototype.warn=function(e){this.print(o.LOGGER_LEVEL_WARNING,o.LOGGER_LEVEL_WARNING_TITLE,e)},o.prototype.error=function(e){this.print(o.LOGGER_LEVEL_ERROR,o.LOGGER_LEVEL_ERROR_TITLE,"["+e.code+"]"+e.name+" "+e.message)},o.prototype.print=function(o,t,n){if(o>=e.eco.Logger.loggerLevel){var i=new Date,E="["+t+"] ["+(i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds())+"] ";E+=n;try{console.log(E)}catch(e){console.log("에러 : "+e.message)}}},o.LOGGER_LEVEL_DEBUG=1e3,o.LOGGER_LEVEL_INFO=2e3,o.LOGGER_LEVEL_WARNING=3e3,o.LOGGER_LEVEL_ERROR=4e3,o.LOGGER_LEVEL_DEBUG_TITLE="DEBUG",o.LOGGER_LEVEL_INFO_TITLE="INFO",o.LOGGER_LEVEL_WARNING_TITLE="WARNING",o.LOGGER_LEVEL_ERROR_TITLE="ERROR",o.loggerLevel=o.LOGGER_LEVEL_ERROR,o}();o.Logger=t;var n=function(){function o(){this.logger=new e.eco.Logger(this)}return o.prototype.postAjax=function(e,o,t,n,i,E){$.ajax({type:"GET",async:!0,url:e,crossDomain:!0,dataType:"json",timeout:5e3,cache:!1,data:o,success:function(e){"function"!=typeof t&&"object"!=typeof t||t(e,i,E)},error:function(e){"function"!=typeof n&&"object"!=typeof t||n(e)}})},o.prototype.xDomainRequest=function(e,o,t,n,i,E){var r=new XDomainRequest;r.open("get",e),r.onprogress=function(){},r.ontimeout=function(){},r.onerror=function(){},r.onload=function(){var e=JSON.parse(r.responseText);t(e,i,E)},setTimeout(function(){r.send()},0)},o}();o.Ajax=n;var i=function(){function o(){this.logger=new e.eco.Logger(this),this.ajax=new e.eco.Ajax,this.contentApi="//eco.eduwill.net/api/contents/"+e.eco.EcoContentHandler.ECO_VERSION+"/"}return o.prototype.getEcoMode=function(){return o.ECO_MODE},o.prototype.setEcoMode=function(e){this.logger.debug("ecoMode : "+e),o.ECO_MODE=e},o.prototype.setLogLevel=function(e){this.logger.setLoggerLevel(e),this.logger.info("로그레벨 변경 성공.")},o.prototype.getLogLevel=function(){return this.logger.getLoggerLevel()},o.prototype.ecoModeInit=function(){this.logger.info("페이지 URL을 분석하여 출력모드를 설정합니다.");var o=document.location.href;if(this.logger.debug("currUrl : "+o),this.logger.debug("eco content indexof : "+o.indexOf(e.eco.EcoContentHandler.ECO_MODE_PARAM_NAME)),o.indexOf(e.eco.EcoContentHandler.ECO_MODE_PARAM_NAME)>-1){if(o.indexOf("?")>-1){var t=o.split("?")[1];if(t.indexOf("&")>-1){var n,i,E=t.split("&");this.logger.debug("paramArray : "+E);for(var r=0;r<E.length;r++)n=E[r].split("=")[0],i=E[r].split("=")[1],this.logger.debug("paramName : "+n),this.logger.debug("paramValue : "+i),n==e.eco.EcoContentHandler.ECO_MODE_PARAM_NAME&&(this.setEcoMode(i),this.logger.info("출력모드 분석결과 - 출력모드가 설정되었습니다.["+this.getEcoMode()+"]"))}else t.split("=")[0]==e.eco.EcoContentHandler.ECO_MODE_PARAM_NAME&&(this.setEcoMode(t.split("=")[1]),this.logger.info("출력모드 분석결과 - 출력모드가 설정되었습니다.["+this.getEcoMode()+"]"))}}else this.logger.info("출력모드 분석결과 - 출력모드를 설정하지 않아 기본모드(운영)로 실행합니다.")},o.prototype.run=function(){if(this.logger.info("ECO 프로세스 시작."),this.ecoModeInit(),this.logger.info("페이지 마크업을 분석하여 ECO 콘텐츠 사용여부를 확인합니다."),$("["+e.eco.EcoContentHandler.ECO_INDENTITY_ATTR+"]")){this.logger.info("해당 페이지는 ECO 콘텐츠를 사용하고 있습니다.");var o,t="";if($("["+e.eco.EcoContentHandler.ECO_INDENTITY_ATTR+"]").each(function(n){""!=(o=$(this).attr(e.eco.EcoContentHandler.ECO_INDENTITY_ATTR))&&(t+=""==t?o:","+o)}),this.logger.debug("content_id_array_1 : "+t),null!=t&&""!=t){var n={ecoMode:this.getEcoMode()};this.logger.debug("API - "+this.contentApi+t),this.logger.debug("param - "+JSON.stringify(n)),this.logger.debug("window.XDomainRequest : "+window.XDomainRequest),window.XDomainRequest?this.ajax.xDomainRequest(this.contentApi+t,n,this.successCallback,this.failCallback,"R",""):this.ajax.postAjax(this.contentApi+t,n,this.successCallback,this.failCallback,"R","")}}else this.logger.debug("해당 페이지는 ECO 콘텐츠를 사용하지 않습니다.")},o.prototype.get=function(e,o,t){if(this.logger.info("ECO 프로세스 시작."),this.logger.debug("content_id - "+e),this.logger.debug("objectId - "+o),null!=e&&""!=e){var n={ecoMode:this.getEcoMode()};this.logger.debug("API - "+this.contentApi+e),this.logger.debug("param - "+JSON.stringify(n)),this.logger.debug("window.XDomainRequest : "+window.XDomainRequest),window.XDomainRequest?this.ajax.xDomainRequest(this.contentApi+e,n,this.successCallback,this.failCallback,t,o):this.ajax.postAjax(this.contentApi+e,n,this.successCallback,this.failCallback,t,o)}},o.prototype.successCallback=function(o,t,n){var i=new e.eco.Logger(this);i.info("데이터통신 결과 - 성공.");var E=o.data,r=E.length;if(i.debug("contentsData : "+JSON.stringify(E)),i.debug("contentsCount : "+r),null!=t&&""!=t||(t="R"),i.debug("type : "+t),r>0){for(var c=void 0,g=void 0,s=void 0,l=0;l<r;l++)if(s=E[l],i.debug("contentData["+l+"] : "+JSON.stringify(s)),null!=s&&null!=s)if(c=null==s.content_id?"":s.content_id,g=null==s.template?"":s.template,i.info("조회 데이터 > 콘텐츠번호 - "+c),i.info("조회 데이터 > 템플릿 - "+g),0!=c&&""!=g)try{i.info("페이지에 콘텐츠 출력 시작.");var a='<iframe src="//img.eduwill.net/resources/eco/eco_log_collect.html?contentId='+c+'" width="0" height="0" frameborder="0" style="width:0px;height:0px;display: block;">';i.debug("addContent : "+a),null==n||""==n?"R"==t?$("["+e.eco.EcoContentHandler.ECO_INDENTITY_ATTR+"="+c+"]").html(g):"A"==t&&$("["+e.eco.EcoContentHandler.ECO_INDENTITY_ATTR+"="+c+"]").append(g):"R"==t?$("[id="+n+"]").html(g):"A"==t&&$("[id="+n+"]").append(g),i.info("페이지에 콘텐츠 출력 성공."),$("["+e.eco.EcoContentHandler.ECO_INDENTITY_ATTR+"="+c+"]").append(a),i.info("콘텐츠 출력로그 기록.[Google Analytics]")}catch(e){i.info("콘텐츠 출력 실패."),i.error(e)}else i.info("템플릿이 존재하지 않습니다.");else i.info("콘텐츠가 존재하지 않습니다.");var L=new e.eco.EcoContentHandler;"S"!=L.getEcoMode()&&"D"!=L.getEcoMode()||stageModeInit()}else i.info("콘텐츠가 존재하지 않습니다.");i.info("ECO 프로세스 종료.")},o.prototype.failCallback=function(o){var t=new e.eco.Logger(this);t.info("데이터통신 결과 : 실패."),t.error(o)},o.ECO_VERSION="v2",o.ECO_INDENTITY_ATTR="data-eduwill-eco-content",o.ECO_MODE_PARAM_NAME="ECO_MODE",o.ECO_MODE="L",o}();o.EcoContentHandler=i}(e.eco||(e.eco={}))}(eduwill||(eduwill={})),$(function(){void 0===window.ecoRunYn&&((ecoContentHandler=new eduwill.eco.EcoContentHandler).run(),window.ecoRunYn="Y")});